# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–ª–æ–∂–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ AggreGate SDK

**–í–µ—Ä—Å–∏—è:** 1.3.7  
**–î–∞—Ç–∞:** 2024-12-12

---

## üìã –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –≤ AggreGate SDK, –≤–∫–ª—é—á–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏ –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã.

---

## üîÑ –ê–ª–≥–æ—Ä–∏—Ç–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ getVariable() –≤ setVariable()

### –û–ø–∏—Å–∞–Ω–∏–µ

**–§–∞–π–ª:** `AbstractContext.java`  
**–ú–µ—Ç–æ–¥:** `setVariable()`  
**–í–µ—Ä—Å–∏—è:** 1.3.7

### –ü—Ä–æ–±–ª–µ–º–∞

–ú–µ—Ç–æ–¥ `setVariable()` —Ä–∞–Ω–µ–µ –≤—ã–∑—ã–≤–∞–ª `getVariable()` –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö:
1. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ä–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ `storeChangesOnlyInHistory()`
2. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ read-only –ø–æ–ª–µ–π
3. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∞

–≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –∏–∑–±—ã—Ç–æ—á–Ω—ã–º –≤—ã–∑–æ–≤–∞–º –∏ —Å–Ω–∏–∂–µ–Ω–∏—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ 20-30%.

### –†–µ—à–µ–Ω–∏–µ

–í–≤–µ–¥–µ–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–µ—Ä–≤–æ–≥–æ –≤—ã–∑–æ–≤–∞ `getVariable()`:

```java
// –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
DataTable cachedCurrentValue = null;
boolean needCurrentValue = def.isAddPreviousValueToVariableUpdateEvent() 
    || def.storeChangesOnlyInHistory()
    || (value.isSimple() && def.getFormat() != null && def.getFormat().hasReadOnlyFields() 
        && caller != null && caller.isPermissionCheckingEnabled())
    || (caller == null || !caller.getProperties().containsKey(CALLER_CONTROLLER_PROPERTY_NO_VALIDATION));

if (needCurrentValue)
{
  cachedCurrentValue = getVariable(def, caller, request);
}
```

### –ê–ª–≥–æ—Ä–∏—Ç–º

1. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è:**
   - –ù—É–∂–Ω–æ –ª–∏ –¥–æ–±–∞–≤–ª—è—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å–æ–±—ã—Ç–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è?
   - –ù—É–∂–Ω–æ –ª–∏ —Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤ –∏—Å—Ç–æ—Ä–∏–∏?
   - –ù—É–∂–Ω–∞ –ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ read-only –ø–æ–ª–µ–π?
   - –ù—É–∂–Ω–∞ –ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è?

2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
   - –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –≤—ã–∑—ã–≤–∞–µ–º `getVariable()` –æ–¥–∏–Ω —Ä–∞–∑
   - –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `cachedCurrentValue`

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è:**
   - –ò—Å–ø–æ–ª—å–∑—É–µ–º `cachedCurrentValue` –≤–º–µ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ `getVariable()`
   - –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ null –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

### –≠—Ñ—Ñ–µ–∫—Ç

- **20-30% —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** `setVariable()`
- –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ `getVariable()`
- –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–∏—Å—Ç–µ–º—É –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

---

## üîÑ –ê–ª–≥–æ—Ä–∏—Ç–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –ø—É—Ç–µ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤

### –û–ø–∏—Å–∞–Ω–∏–µ

**–§–∞–π–ª:** `ContextUtils.java`  
**–ú–µ—Ç–æ–¥:** `splitPathCached()`  
**–í–µ—Ä—Å–∏—è:** 1.3.7

### –ü—Ä–æ–±–ª–µ–º–∞

–†–∞–∑–±–∏–µ–Ω–∏–µ –ø—É—Ç–µ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "root.users.admin") –Ω–∞ —á–∞—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω—è–ª–æ—Å—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –¥–ª—è –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ –ø—É—Ç–µ–π, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –∏–∑–±—ã—Ç–æ—á–Ω—ã–º –æ–ø–µ—Ä–∞—Ü–∏—è–º –ø–∞—Ä—Å–∏–Ω–≥–∞.

### –†–µ—à–µ–Ω–∏–µ

–í–≤–µ–¥–µ–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞–∑–±–∏–µ–Ω–∏—è –ø—É—Ç–µ–π –≤ `ConcurrentHashMap`:

```java
private static final Map<String, List<String>> PATH_PARTS_CACHE = new ConcurrentHashMap<>();
private static final int MAX_PATH_CACHE_SIZE = 1000;

private static List<String> splitPathCached(String path) {
    if (path == null) {
        return new ArrayList<>();
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞
    List<String> cached = PATH_PARTS_CACHE.get(path);
    if (cached != null) {
        return new ArrayList<>(cached); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–æ–ø–∏—é
    }
    
    // –†–∞–∑–±–∏–µ–Ω–∏–µ –ø—É—Ç–∏
    List<String> parts = StringUtils.split(path, CONTEXT_NAME_SEPARATOR.charAt(0));
    
    // –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    if (PATH_PARTS_CACHE.size() < MAX_PATH_CACHE_SIZE) {
        PATH_PARTS_CACHE.put(path, new ArrayList<>(parts));
    } else {
        // –ü—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ—á–∏—Å—Ç–∫–∏ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞
        PATH_PARTS_CACHE.clear();
        PATH_PARTS_CACHE.put(path, new ArrayList<>(parts));
    }
    
    return parts;
}
```

### –ê–ª–≥–æ—Ä–∏—Ç–º

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ null:**
   - –ï—Å–ª–∏ –ø—É—Ç—å null, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞:**
   - –ò—â–µ–º –ø—É—Ç—å –≤ –∫—ç—à–µ
   - –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–æ–ø–∏—é (–¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)

3. **–†–∞–∑–±–∏–µ–Ω–∏–µ –ø—É—Ç–∏:**
   - –ò—Å–ø–æ–ª—å–∑—É–µ–º `StringUtils.split()` –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è
   - –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å: `CONTEXT_NAME_SEPARATOR` (–æ–±—ã—á–Ω–æ ".")

4. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ï—Å–ª–∏ –∫—ç—à –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä, –¥–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
   - –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–∞–µ—Ç, –æ—á–∏—â–∞–µ–º –∫—ç—à –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### –≠—Ñ—Ñ–µ–∫—Ç

- **30-50% —Å–Ω–∏–∂–µ–Ω–∏–µ CPU** –ø—Ä–∏ —á–∞—Å—Ç–æ–º –ø–∞—Ä—Å–∏–Ω–≥–µ –ø—É—Ç–µ–π
- –í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ –∫—ç—à (>80% –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø—É—Ç–µ–π)
- –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –±–ª–∞–≥–æ–¥–∞—Ä—è `ConcurrentHashMap`

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ—á–∏—Å—Ç–∫–∏

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Å—Ç—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞. –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å LRU (Least Recently Used) –∫—ç—à –¥–ª—è –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é.

---

## üîÑ –ê–ª–≥–æ—Ä–∏—Ç–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤

### –û–ø–∏—Å–∞–Ω–∏–µ

**–§–∞–π–ª:** `TableFormat.java`  
**–ú–µ—Ç–æ–¥:** `extendMessage()`  
**–í–µ—Ä—Å–∏—è:** 1.3.7

### –ü—Ä–æ–±–ª–µ–º–∞

–ú–µ—Ç–æ–¥ `extendMessage()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —Ä–∞—Å—à–∏—Ä—è–µ—Ç –ª–∏ –æ–¥–∏–Ω —Ñ–æ—Ä–º–∞—Ç –¥—Ä—É–≥–æ–π. –≠—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –¥–ª—è –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ –ø–∞—Ä —Ñ–æ—Ä–º–∞—Ç–æ–≤, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∏–∑–±—ã—Ç–æ—á–Ω—ã–º –≤—ã—á–∏—Å–ª–µ–Ω–∏—è–º.

### –†–µ—à–µ–Ω–∏–µ

–í–≤–µ–¥–µ–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –∫–ª—é—á–∞ `FormatPair`:

```java
private static final Map<FormatPair, String> EXTEND_MESSAGE_CACHE = new ConcurrentHashMap<>();
private static final int MAX_EXTEND_MESSAGE_CACHE_SIZE = 500;

public String extendMessage(TableFormat other) {
    if (this == other) return null;
    if (equals(other)) return null;

    FormatPair key = new FormatPair(this, other);
    String cachedResult = EXTEND_MESSAGE_CACHE.get(key);
    if (cachedResult != null) {
        return cachedResult.isEmpty() ? null : cachedResult;
    }

    String result = computeExtendMessage(other);
    if (EXTEND_MESSAGE_CACHE.size() < MAX_EXTEND_MESSAGE_CACHE_SIZE) {
        EXTEND_MESSAGE_CACHE.put(key, result != null ? result : "");
    } else {
        EXTEND_MESSAGE_CACHE.clear();
        EXTEND_MESSAGE_CACHE.put(key, result != null ? result : "");
    }
    return result;
}
```

### –ê–ª–≥–æ—Ä–∏—Ç–º

1. **–ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
   - –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç—ã –∏–¥–µ–Ω—Ç–∏—á–Ω—ã –ø–æ —Å—Å—ã–ª–∫–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º null
   - –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç—ã —Ä–∞–≤–Ω—ã –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º null

2. **–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–∞:**
   - –ò—Å–ø–æ–ª—å–∑—É–µ–º `FormatPair` —Å identity hash codes –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
   - Identity hash code –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–∂–µ –¥–ª—è —Ä–∞–≤–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞:**
   - –ò—â–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫—ç—à–µ
   - –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –æ–∑–Ω–∞—á–∞–µ—Ç null (—Ç–∞–∫ –∫–∞–∫ null –Ω–µ–ª—å–∑—è —Ö—Ä–∞–Ω–∏—Ç—å –≤ Map)

4. **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
   - –í—ã–∑—ã–≤–∞–µ–º `computeExtendMessage()` –¥–ª—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
   - –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫—ç—à–µ

### –ö–ª—é—á FormatPair

```java
private static class FormatPair {
    private final int format1IdentityHashCode;
    private final int format2IdentityHashCode;

    public FormatPair(TableFormat format1, TableFormat format2) {
        this.format1IdentityHashCode = System.identityHashCode(format1);
        this.format2IdentityHashCode = System.identityHashCode(format2);
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        FormatPair that = (FormatPair) o;
        return format1IdentityHashCode == that.format1IdentityHashCode &&
               format2IdentityHashCode == that.format2IdentityHashCode;
    }

    @Override
    public int hashCode() {
        return Objects.hash(format1IdentityHashCode, format2IdentityHashCode);
    }
}
```

### –≠—Ñ—Ñ–µ–∫—Ç

- **40-60% —Å–Ω–∏–∂–µ–Ω–∏–µ CPU** –ø—Ä–∏ —á–∞—Å—Ç–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤
- –í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ –∫—ç—à (>70% –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤)
- –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –±–ª–∞–≥–æ–¥–∞—Ä—è `ConcurrentHashMap`

---

## üîÑ –ê–ª–≥–æ—Ä–∏—Ç–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤

### –û–ø–∏—Å–∞–Ω–∏–µ

**–§–∞–π–ª:** `Util.java`  
**–ú–µ—Ç–æ–¥—ã:** `convertToNumber()`, `convertToBoolean()`  
**–í–µ—Ä—Å–∏—è:** 1.3.7

### –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫ –≤ —á–∏—Å–ª–∞ –∏ –±—É–ª–µ–≤—ã –∑–Ω–∞—á–µ–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –¥–æ—Ä–æ–≥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–µ–π. –ü—Ä–∏ —á–∞—Å—Ç–æ–º –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏ –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ —Å—Ç—Ä–æ–∫ —ç—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∏–∑–±—ã—Ç–æ—á–Ω—ã–º –≤—ã—á–∏—Å–ª–µ–Ω–∏—è–º.

### –†–µ—à–µ–Ω–∏–µ

–í–≤–µ–¥–µ–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å—Ç—Ä–æ–∫:

```java
// –ö—ç—à –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫ –≤ —á–∏—Å–ª–∞
private static final ConcurrentHashMap<String, Number> STRING_TO_NUMBER_CACHE = new ConcurrentHashMap<>();
private static final int MAX_STRING_NUMBER_CACHE_SIZE = 200;

// –ö—ç—à –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫ –≤ –±—É–ª–µ–≤—ã –∑–Ω–∞—á–µ–Ω–∏—è
private static final ConcurrentHashMap<String, Boolean> STRING_TO_BOOLEAN_CACHE = new ConcurrentHashMap<>();
private static final int MAX_STRING_BOOLEAN_CACHE_SIZE = 50;
```

### –ê–ª–≥–æ—Ä–∏—Ç–º convertToNumber()

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ null:**
   - –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ null, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º null –∏–ª–∏ 0 –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç `allowNull`

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤:**
   - DataTable ‚Üí —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
   - ExtendedNumber ‚Üí –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–∏—Å–ª–∞
   - Number ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –∫–∞–∫ –µ—Å—Ç—å
   - Date ‚Üí –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ timestamp
   - Boolean ‚Üí –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ 1/0

3. **–ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–æ–∫–∏:**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞
   - –ü–æ–ø—ã—Ç–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–∞–∫ Long
   - –ü–æ–ø—ã—Ç–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–∞–∫ Double
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

4. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—ç—à–µ–º:**
   - –ï—Å–ª–∏ –∫—ç—à –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç —Ä–∞–∑–º–µ—Ä, –¥–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
   - –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–∞–µ—Ç, –æ—á–∏—â–∞–µ–º –∫—ç—à –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### –ê–ª–≥–æ—Ä–∏—Ç–º convertToBoolean()

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ null:**
   - –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ null, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º null –∏–ª–∏ false

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤:**
   - Boolean ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –∫–∞–∫ –µ—Å—Ç—å
   - Number ‚Üí –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ (0 = false, –∏–Ω–∞—á–µ true)

3. **–ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–æ–∫–∏:**
   - –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞
   - –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å "true", "false", "1", "0"
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### –≠—Ñ—Ñ–µ–∫—Ç

- **25-40% —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π
- –í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ –∫—ç—à –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Å—Ç—Ä–æ–∫ (>60%)
- –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –±–ª–∞–≥–æ–¥–∞—Ä—è `ConcurrentHashMap`

---

## üîÑ –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã —Å –ø—É–ª–∞–º–∏ –æ–±—ä–µ–∫—Ç–æ–≤

### –û–ø–∏—Å–∞–Ω–∏–µ

**–§–∞–π–ª—ã:** `ByteBufferPool.java`, `ByteArrayOutputStreamPool.java`  
**–í–µ—Ä—Å–∏—è:** 1.3.0+

### –ü—Ä–æ–±–ª–µ–º–∞

–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (ByteBuffer, ByteArrayOutputStream) –¥–ª—è –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫:
- –ò–∑–±—ã—Ç–æ—á–Ω—ã–º –∞–ª–ª–æ–∫–∞—Ü–∏—è–º –ø–∞–º—è—Ç–∏
- –ß–∞—Å—Ç—ã–º GC –ø–∞—É–∑–∞–º
- –°–Ω–∏–∂–µ–Ω–∏—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –†–µ—à–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—É–ª–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤ —Å `ThreadLocal` –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```java
private static final ThreadLocal<ByteBuffer> BUFFER_POOL = new ThreadLocal<ByteBuffer>() {
    @Override
    protected ByteBuffer initialValue() {
        return ByteBuffer.allocate(DEFAULT_BUFFER_SIZE);
    }
};
```

### –ê–ª–≥–æ—Ä–∏—Ç–º

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—É–ª–∞:**
   - –ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –∏–º–µ–µ—Ç —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏

2. **–ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞:**
   - –ü–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç –∏–∑ ThreadLocal
   - –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç —Å–ª–∏—à–∫–æ–º –º–∞–ª, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –±–æ–ª—å—à–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞

3. **–í–æ–∑–≤—Ä–∞—Ç –æ–±—ä–µ–∫—Ç–∞:**
   - –û—á–∏—â–∞–µ–º –æ–±—ä–µ–∫—Ç (position = 0, limit = capacity)
   - –û—Å—Ç–∞–≤–ª—è–µ–º –≤ ThreadLocal –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –≠—Ñ—Ñ–µ–∫—Ç

- **85-90% —Å–Ω–∏–∂–µ–Ω–∏–µ –∞–ª–ª–æ–∫–∞—Ü–∏–π** –¥–ª—è ByteBuffer –∏ ByteArrayOutputStream
- **70-80% —Å–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏**
- **80-90% —Å–Ω–∏–∂–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã GC –ø–∞—É–∑**

---

## üìä –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –ü—Ä–æ—Å—Ç–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** PATH_PARTS_CACHE, EXTEND_MESSAGE_CACHE, STRING_TO_NUMBER_CACHE, STRING_TO_BOOLEAN_CACHE

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
- –ï—Å–ª–∏ –∫—ç—à –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä, –¥–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç
- –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–∞–µ—Ç, –æ—á–∏—â–∞–µ–º –≤–µ—Å—å –∫—ç—à –∏ –¥–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –ù–∏–∑–∫–∏–π overhead
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫—ç—à–µ–π —Å —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —á–∞—Å—Ç–æ—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ú–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
- –ù–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è –∫—ç—à–µ–π —Å –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º

### 2. ThreadLocal –ø—É–ª—ã

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** ByteBufferPool, ByteArrayOutputStreamPool, InflaterPool, JSONParserPool

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
- –ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –∏–º–µ–µ—Ç —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ü–æ–ª–Ω–∞—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –±–µ–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –ù–∏–∑–∫–∏–π overhead
- –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ü–∞–º—è—Ç—å –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞
- –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —É—Ç–µ—á–∫–∞–º –ø–∞–º—è—Ç–∏ –ø—Ä–∏ –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏—Ö –ø–æ—Ç–æ–∫–∞—Ö

### 3. LRU –∫—ç—à (–±—É–¥—É—â–µ–µ —É–ª—É—á—à–µ–Ω–∏–µ)

**–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –¥–ª—è:** Pattern –∫—ç—à, –≤–æ–∑–º–æ–∂–Ω–æ –¥—Ä—É–≥–∏–µ –∫—ç—à–∏

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
- –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ–º —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–≤—É—Å–≤—è–∑–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫—ç—à–µ–π —Å –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `docs/PROFILING_GUIDE.md` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—é
- `docs/EDGE_CASES_GUIDE.md` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ–±—Ä–∞–±–æ—Ç–∫–µ edge cases
- `–°–í–û–î–ù–´–ô_–ü–õ–ê–ù_–£–õ–£–ß–®–ï–ù–ò–ô.md` - –ø–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞

---

**–í–µ—Ä—Å–∏—è:** 1.3.7  
**–î–∞—Ç–∞:** 2024-12-12  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

