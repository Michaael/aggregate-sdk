# Инструкция по тестированию создания модели и управления элементами

**Дата:** 12.12.2025  
**Версия SDK:** 1.3.6

## Описание теста

Тест `ModelCreationAndManagementTest` проверяет полный цикл работы с моделью через Remote API:

1. **Создание модели** (или использование существующей)
2. **Создание переменных** через `V_MODEL_VARIABLES`
3. **Создание функций** через `V_MODEL_FUNCTIONS`
4. **Создание событий** через `V_MODEL_EVENTS`
5. **Проверка созданных элементов**

## Запуск теста

### Способ 1: Через командную строку

```bash
# Скомпилировать (если еще не скомпилировано)
cd "c:\Users\micha\YandexDisk\AggreGate sdk"
.\gradlew.bat :aggregate-api:compileJava

# Запустить тест
java -cp "examples;aggregate-api/build/classes/java/main;libs/*" examples.ModelCreationAndManagementTest [host] [port] [username] [password] [modelName]
```

### Способ 2: С параметрами по умолчанию

```bash
java -cp "examples;aggregate-api/build/classes/java/main;libs/*" examples.ModelCreationAndManagementTest
```

Параметры по умолчанию:
- **host:** localhost
- **port:** 6460
- **username:** admin
- **password:** admin
- **modelName:** testModel_[timestamp]

### Способ 3: С указанием всех параметров

```bash
java -cp "examples;aggregate-api/build/classes/java/main;libs/*" examples.ModelCreationAndManagementTest localhost 6460 admin admin myTestModel
```

## Что проверяет тест

### Шаг 1: Подключение к серверу
- Подключение к AggreGate серверу
- Аутентификация пользователя

### Шаг 2: Получение контекста пользователя
- Поиск контекста пользователя (`users.{username}`)
- Проверка доступности

### Шаг 3: Получение или создание контекста models
- Поиск контекста `users.{username}.models`
- Создание через функцию `add`, если не существует

### Шаг 4: Получение или создание модели
- Поиск модели `users.{username}.models.{modelName}`
- Создание через функцию `add`, если не существует

### Тест 1: Создание переменных
- Получение текущих определений переменных из `V_MODEL_VARIABLES`
- Создание новой переменной с уникальным именем
- Сохранение изменений

### Тест 2: Создание функций
- Получение текущих определений функций из `V_MODEL_FUNCTIONS`
- Создание новой функции с уникальным именем
- Сохранение изменений

### Тест 3: Создание событий
- Получение текущих определений событий из `V_MODEL_EVENTS`
- Создание нового события с уникальным именем
- Сохранение изменений

### Тест 4: Проверка созданных элементов
- Проверка доступности `V_MODEL_VARIABLES`
- Вывод списка созданных переменных
- Проверка доступности `V_MODEL_FUNCTIONS`
- Вывод списка созданных функций
- Проверка доступности `V_MODEL_EVENTS`
- Вывод списка созданных событий

## Ожидаемый результат

При успешном выполнении тест выводит:

```
========================================
Model Creation and Management Test
========================================
Server: localhost:6460
Username: admin
Model Name: testModel_1234567890

=== Step 1: Connecting to server ===
✓ Connected
✓ Authenticated

=== Step 2: Getting user context ===
✓ User context found: users.admin

=== Step 3: Getting or creating models context ===
✓ Models context found: users.admin.models

=== Step 4: Getting or creating model ===
✓ Model found: users.admin.models.testModel_1234567890

=== Test 1: Creating Variables ===
  Current variables: 0
  Creating variable: testVar_1234567890
  ✓ Variable created: testVar_1234567890

=== Test 2: Creating Functions ===
  Current functions: 0
  Creating function: testFunc_1234567890
  ✓ Function created: testFunc_1234567890

=== Test 3: Creating Events ===
  Current events: 0
  Creating event: testEvent_1234567890
  ✓ Event created: testEvent_1234567890

=== Test 4: Verifying Created Elements ===
  Verifying variables...
    ✓ Variables accessible: 1 definition(s)
    Variables:
      - testVar_1234567890 (Test Variable)
  Verifying functions...
    ✓ Functions accessible: 1 definition(s)
    Functions:
      - testFunc_1234567890 (Test Function)
  Verifying events...
    ✓ Events accessible: 1 definition(s)
    Events:
      - testEvent_1234567890 (Test Event)

========================================
✓ All tests completed successfully!
========================================

Disconnecting...
✓ Disconnected
```

## Возможные ошибки

### Ошибка: "ContextManager is null"
**Причина:** Не удалось получить менеджер контекстов после подключения  
**Решение:** Проверьте подключение к серверу и права пользователя

### Ошибка: "User context not found"
**Причина:** Контекст пользователя не существует  
**Решение:** Убедитесь, что пользователь существует на сервере

### Ошибка: "Could not create models context"
**Причина:** Нет прав на создание контекстов или функция `add` недоступна  
**Решение:** 
- Проверьте права пользователя
- Создайте контекст `models` вручную через веб-интерфейс

### Ошибка: "V_MODEL_VARIABLES not available"
**Причина:** Контекст не является моделью или модель не полностью инициализирована  
**Решение:**
- Убедитесь, что контекст действительно является моделью
- Проверьте, что модель полностью инициализирована на сервере

### Ошибка: "Variable already exists"
**Причина:** Переменная с таким именем уже существует  
**Решение:** Это нормально, тест пропустит создание и продолжит работу

## Структура создаваемых элементов

### Переменная
- **Имя:** `testVar_[timestamp]`
- **Формат:** `<value><S><D=Value>`
- **Описание:** "Test Variable"
- **Читаемая:** true
- **Записываемая:** true

### Функция
- **Имя:** `testFunc_[timestamp]`
- **Входной формат:** пустой
- **Выходной формат:** `<result><S><D=Result>`
- **Описание:** "Test Function"
- **Параллельная:** false

### Событие
- **Имя:** `testEvent_[timestamp]`
- **Формат данных:** `<data><S><D=Event Data>`
- **Описание:** "Test Event"
- **Уровень:** 1

## Примечания

1. **Уникальные имена:** Тест использует временные метки для создания уникальных имен элементов
2. **Безопасное клонирование:** Тест использует `DataTableReplication.copy()` для безопасного клонирования таблиц
3. **Обработка ошибок:** Тест обрабатывает ошибки "not available" для специальных переменных модели
4. **Автоматическое создание:** Тест автоматически создает контекст `models` и модель, если они не существуют

## См. также

- `КАК_СОЗДАТЬ_ПЕРЕМЕННЫЕ_В_МОДЕЛИ.md` - подробное руководство по созданию переменных
- `РЕШЕНИЕ_ПРОБЛЕМЫ_КОНТЕКСТА_МОДЕЛИ.md` - решение проблем с контекстом модели
- `examples/ModelCreationAndManagementTest.java` - исходный код теста

